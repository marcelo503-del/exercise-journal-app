<!DOCTYPE html>
<html lang="en" data-theme="auto">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Exercise & Journal â€” Mobile</title>
<meta name="theme-color" content="#0f172a">
<style>
:root{
  --bg:#0b1220; --card:#0f172a; --ink:#e5e7eb; --muted:#9ca3af;
  --accent:#22c55e; --accent-ink:#052e16; --ring:#334155; --border:#1f2937;
}
:root.light{
  --bg:#f8fafc; --card:#ffffff; --ink:#0b1220; --muted:#475569;
  --accent:#0ea5e9; --accent-ink:#082f49; --ring:#cbd5e1; --border:#e2e8f0;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
.topbar{position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:10px;
  padding:12px 14px;background:linear-gradient(180deg,var(--bg),var(--card));border-bottom:1px solid var(--border)}
.topbar h1{margin:0;font-size:18px}
.pill{border:1px solid var(--ring);background:var(--card);color:var(--ink);padding:8px 12px;border-radius:999px}
.spacer{flex:1}
.tabs{display:flex;gap:8px;flex-wrap:wrap;padding:8px 14px;border-bottom:1px solid var(--border);background:var(--bg)}
.tab{border:1px solid var(--ring);background:transparent;color:var(--ink);padding:8px 12px;border-radius:10px}
.tab.active{border-color:var(--accent);outline:2px solid var(--accent-ink)}
main{padding:12px;max-width:980px;margin:0 auto}
.panel{display:none}.panel.show{display:block}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;box-shadow:0 1px 0 rgba(0,0,0,.05)}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.grid .col-span{grid-column:1 / -1}
.row{display:flex;gap:8px;align-items:center;margin:.5rem 0}
.row-end{display:flex;justify-content:flex-end;gap:8px}
label{font-size:12px;color:var(--muted)}
input,select,textarea,button{width:100%;padding:10px;border-radius:10px;border:1px solid var(--ring);background:var(--bg);color:var(--ink)}
input:focus,select:focus,textarea:focus{outline:2px solid var(--accent);border-color:var(--accent)}
button{background:var(--accent);border-color:transparent;color:white;font-weight:600}
button:hover{filter:brightness(1.05)}
.list{display:grid;gap:8px;margin-top:10px}
.item{background:var(--bg);border:1px solid var(--ring);padding:10px;border-radius:10px}
.item h4{margin:0 0 6px 0}
.badge{display:inline-block;padding:.1rem .5rem;border:1px solid var(--ring);border-radius:999px;font-size:12px;color:var(--muted);margin-right:6px}
.tag{display:inline-block;padding:.1rem .5rem;border:1px solid var(--ring);border-radius:6px;font-size:12px;color:var(--muted);margin-right:6px}
.footer{padding:24px;text-align:center;color:var(--muted)}
hr{border:none;border-top:1px solid var(--border);margin:12px 0}
canvas{width:100%;height:auto;max-height:300px}
.small{font-size:12px;color:var(--muted)}
textarea{min-height:90px}
</style>
</head>
<body>
<header class="topbar">
  <h1>Exercise & Journal</h1>
  <div class="spacer"></div>
  <button id="themeBtn" class="pill" title="Theme">ðŸŒ“ Theme</button>
</header>

<nav class="tabs" aria-label="Sections">
  <button class="tab active" data-target="dash">Dashboard</button>
  <button class="tab" data-target="workouts">Workouts</button>
  <button class="tab" data-target="journal">Journal</button>
  <button class="tab" data-target="settings">Export/Import</button>
</nav>

<main>
  <section id="dash" class="panel show">
    <div class="cards">
      <div class="card">
        <h3>Quick Workout</h3>
        <form id="quickWorkoutForm">
          <div class="row">
            <label>Type</label>
            <select id="qwType" required>
              <option>Gym</option><option>PT</option><option>Walk</option>
              <option>Run</option><option>Swim</option><option>Ruck</option><option>Other</option>
            </select>
          </div>
          <div class="row">
            <label>Notes</label>
            <input id="qwNotes" placeholder="Sets Ã— Reps Ã— Weight, route, pace...">
          </div>
          <div class="row">
            <label>Tags</label>
            <input id="qwTags" placeholder="legs strength AM">
          </div>
          <button type="submit">Add Workout</button>
        </form>
      </div>
      <div class="card">
        <h3>Quick Journal</h3>
        <form id="quickJournalForm">
          <div class="row">
            <label>Entry</label>
            <textarea id="qjText" placeholder="One win, one lesson."></textarea>
          </div>
          <div class="row">
            <label>Tags</label>
            <input id="qjTags" placeholder="mindset family recovery">
          </div>
          <button type="submit">Save Entry</button>
        </form>
      </div>
    </div>

    <div class="cards">
      <div class="card">
        <h3>Workouts â€” last 12 weeks</h3>
        <canvas id="wkChart" width="640" height="280"></canvas>
      </div>
      <div class="card">
        <h3>By Type â€” last 30 days</h3>
        <canvas id="typeChart" width="640" height="280"></canvas>
      </div>
    </div>
  </section>

  <section id="workouts" class="panel">
    <h2>Workouts</h2>

    <details class="card">
      <summary><strong>Templates</strong> â€” builtâ€‘in & custom</summary>
      <div class="grid">
        <div>
          <label for="tplSelect">Builtâ€‘in</label>
          <select id="tplSelect">
            <option value="">â€” choose â€”</option>
            <option value="GVT Legs">GVT Legs (10Ã—10 Squat/Leg Press, 3Ã—15 RDL, 3Ã—15 Calves)</option>
            <option value="5x5 Full Body">5Ã—5 Full Body (Squat, Bench/Press, Row/Dead)</option>
            <option value="PPL Push">PPL Push (Bench, OHP, Dips)</option>
            <option value="PPL Pull">PPL Pull (Deadlift, Row, Pull-ups)</option>
            <option value="PPL Legs">PPL Legs (Squat, Lunges, Ham Curl)</option>
          </select>
        </div>
        <div class="col-span">
          <label>Template Notes</label>
          <textarea id="tplNotes" placeholder="Selected templateâ€™s notes appear here. Edit as needed."></textarea>
        </div>
      </div>
      <div class="row-end"><button id="applyTplBtn" type="button">Apply to form</button></div>
      <hr>
      <div class="grid">
        <div><label for="ctName">Save current as</label><input id="ctName" placeholder="My Heavy Legs"></div>
        <div class="col-span"><label for="ctNotes">Template notes</label><textarea id="ctNotes" placeholder="Will save these notes (or the formâ€™s notes)"></textarea></div>
      </div>
      <div class="row-end"><button id="saveCustomTplBtn" type="button">Save Custom Template</button></div>
      <div id="customTplList" class="list"></div>
    </details>

    <form id="workoutForm" class="card">
      <div class="grid">
        <div>
          <label for="wDate">Date</label>
          <input type="date" id="wDate" required>
        </div>
        <div>
          <label for="wType">Type</label>
          <select id="wType" required>
            <option>Gym</option><option>PT</option><option>Walk</option>
            <option>Run</option><option>Swim</option><option>Ruck</option><option>Other</option>
          </select>
        </div>
        <div class="col-span">
          <label for="wNotes">Notes</label>
          <textarea id="wNotes" placeholder="Sets Ã— Reps Ã— Weight, route, pace, etc."></textarea>
        </div>
        <div class="col-span">
          <label for="wTags">Tags</label>
          <input id="wTags" placeholder="legs strength AM GVT">
        </div>
      </div>
      <button type="submit">Add</button>
    </form>

    <div class="card">
      <div class="row">
        <label>Filter by tag</label>
        <input id="wFilter" placeholder="e.g., legs">
        <button id="wClearFilter" type="button">Clear</button>
      </div>
    </div>

    <div class="list" id="workoutList" aria-live="polite"></div>
  </section>

  <section id="journal" class="panel">
    <h2>Journal</h2>
    <form id="journalForm" class="card">
      <div class="grid">
        <div><label for="jDate">Date</label><input type="date" id="jDate" required></div>
        <div class="col-span"><label for="jText">Entry</label><textarea id="jText" placeholder="What moved me toward my goals today?"></textarea></div>
        <div class="col-span"><label for="jTags">Tags</label><input id="jTags" placeholder="mindset family recovery"></div>
      </div>
      <button type="submit">Save</button>
    </form>

    <div class="card">
      <div class="row">
        <label>Filter by tag</label>
        <input id="jFilter" placeholder="e.g., mindset">
        <button id="jClearFilter" type="button">Clear</button>
      </div>
    </div>

    <div class="list" id="journalList" aria-live="polite"></div>
  </section>

  <section id="settings" class="panel">
    <h2>Export & Import (copy/paste)</h2>
    <div class="card">
      <button id="exportBtn">Copy Data to Clipboard</button>
      <p class="small">This copies a JSON backup of your workouts, journal, and templates. Paste it into Notes.</p>
    </div>
    <div class="card">
      <label>Paste backup JSON here, then click Import:</label>
      <textarea id="importBox" placeholder='{"workouts":[...],"journal":[...],"templates":[...]}'></textarea>
      <div class="row-end"><button id="importBtn">Import from Text</button></div>
    </div>
  </section>
</main>

<footer class="footer"><small>Offline, private, and yours. ðŸ’ª</small></footer>

<script>
/* -------- Storage Keys & Helpers -------- */
const K = { workouts:'ej_workouts_v2', journal:'ej_journal_v2', templates:'ej_templates_v2', theme:'ej_theme_v1' };
const $ = (s,el=document)=>el.querySelector(s), $$ = (s,el=document)=>Array.from(el.querySelectorAll(s));
const todayISO = ()=> new Date().toISOString().slice(0,10);
function load(k,f=[]) { try { const r=localStorage.getItem(k); return r?JSON.parse(r):f;} catch{ return f; } }
function save(k,d){ localStorage.setItem(k, JSON.stringify(d)); }
function toTags(str){ if(!str) return []; return str.split(/[,\s]+/).map(s=>s.trim()).filter(Boolean).slice(0,12); }
function toast(msg){ const el=document.createElement('div'); el.className='item'; el.textContent=msg;
  el.style.position='fixed'; el.style.right='12px'; el.style.bottom='12px'; el.style.zIndex='9999';
  document.body.appendChild(el); setTimeout(()=>el.remove(),1400); }

/* -------- Theme -------- */
(function initTheme(){
  let pref = localStorage.getItem(K.theme) || 'auto';
  const root = document.documentElement;
  const apply = () => {
    const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
    const light = pref==='light' || (pref==='auto' && prefersLight);
    root.classList.toggle('light', light);
  };
  apply();
  $('#themeBtn').addEventListener('click', ()=>{
    pref = pref==='auto' ? 'dark' : (pref==='dark' ? 'light' : 'auto');
    localStorage.setItem(K.theme, pref); apply(); toast('Theme: '+pref);
  });
})();

/* -------- Tabs -------- */
$$('.tab').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    $$('.tab').forEach(b=>b.classList.remove('active')); btn.classList.add('active');
    const id = btn.dataset.target; $$('.panel').forEach(p=>p.classList.remove('show')); $('#'+id).classList.add('show');
  });
});

/* -------- Prefill Dates -------- */
$('#wDate').value = todayISO(); $('#jDate').value = todayISO();

/* -------- Templates -------- */
const builtIns = [
  {name:'GVT Legs', notes:'Squat or Leg Press 10Ã—10 @ ~60% 1RM\\nRomanian Deadlift 3Ã—15\\nStanding Calf Raise 3Ã—15\\nCore 3Ã—15'},
  {name:'5x5 Full Body', notes:'Back Squat 5Ã—5\\nBench/Overhead Press 5Ã—5\\nRow/Deadlift 5Ã—5\\nAccessories 2Ã—12'},
  {name:'PPL Push', notes:'Bench Press 4Ã—6â€“8\\nOverhead Press 3Ã—8â€“10\\nDips 3Ã—AMRAP\\nTriceps 3Ã—12'},
  {name:'PPL Pull', notes:'Deadlift 3Ã—5\\nBarbell Row 4Ã—8\\nPull-ups 3Ã—AMRAP\\nBiceps 3Ã—12'},
  {name:'PPL Legs', notes:'Back Squat 5Ã—5\\nWalking Lunges 3Ã—10e\\nHamstring Curl 3Ã—12\\nCalves 3Ã—15'}
];
function renderCustomTemplates(){
  const list = $('#customTplList'); list.innerHTML='';
  const arr = load(K.templates);
  if(arr.length===0){ list.innerHTML='<div class="item small">No custom templates yet.</div>'; return; }
  for(const t of arr){
    const div=document.createElement('div'); div.className='item';
    div.innerHTML = `<strong>${t.name}</strong><div>${t.notes.replace(/\\n/g,'<br>')}</div>
      <div class="row-end"><button data-act="use">Use</button> <button data-act="del">Delete</button></div>`;
    div.querySelector('[data-act="use"]').addEventListener('click', ()=>{ $('#wNotes').value=t.notes; toast('Template applied'); });
    div.querySelector('[data-act="del"]').addEventListener('click', ()=>{ save(K.templates, load(K.templates).filter(x=>x!==t)); renderCustomTemplates(); toast('Template deleted'); });
    list.appendChild(div);
  }
}
$('#tplSelect').addEventListener('change', e=>{
  const t = builtIns.find(x=>x.name===e.target.value); $('#tplNotes').value = t ? t.notes : '';
});
$('#applyTplBtn').addEventListener('click', ()=>{
  const txt = $('#tplNotes').value.trim(); if(!txt){ toast('Pick/write a template first'); return; }
  $('#wNotes').value = txt; toast('Template applied');
});
$('#saveCustomTplBtn').addEventListener('click', ()=>{
  const name = $('#ctName').value.trim() || 'Custom';
  const notes = ($('#ctNotes').value.trim() || $('#wNotes').value.trim());
  if(!notes){ toast('Nothing to save'); return; }
  const arr = load(K.templates); arr.push({name, notes}); save(K.templates, arr);
  $('#ctName').value=''; $('#ctNotes').value=''; renderCustomTemplates(); toast('Template saved');
});

/* -------- Workouts -------- */
function renderWorkouts(filterTag=''){
  const list=$('#workoutList'); list.innerHTML='';
  const items=load(K.workouts);
  const tag=filterTag.trim().toLowerCase();
  const filtered = tag ? items.filter(i => (i.tags||[]).some(t=>t.toLowerCase()===tag)) : items;
  if(filtered.length===0){ list.innerHTML='<div class="item small">No workouts yet.</div>'; return; }
  filtered.sort((a,b)=> b.date.localeCompare(a.date));
  for(const it of filtered){
    const div=document.createElement('div'); div.className='item';
    const tags=(it.tags||[]).map(t=>`<span class="badge">#${t}</span>`).join(' ');
    div.innerHTML = `<h4>${it.type} <span class="badge">${it.date}</span> ${tags}</h4>
      <div>${(it.notes||'').replace(/\\n/g,'<br>')}</div>
      <div class="row-end"><button data-act="del">Delete</button></div>`;
    div.querySelector('[data-act="del"]').addEventListener('click', ()=>{
      save(K.workouts, load(K.workouts).filter(x=>!(x.date===it.date && x.type===it.type && x.notes===it.notes)));
      renderWorkouts(tag); toast('Deleted workout'); drawCharts();
    });
    list.appendChild(div);
  }
}
$('#workoutForm').addEventListener('submit', e=>{
  e.preventDefault();
  const date=$('#wDate').value||todayISO(), type=$('#wType').value.trim(), notes=$('#wNotes').value.trim(), tags=toTags($('#wTags').value);
  const arr=load(K.workouts); arr.push({date,type,notes,tags}); save(K.workouts,arr);
  $('#wNotes').value=''; $('#wTags').value=''; renderWorkouts($('#wFilter').value); toast('Workout added'); drawCharts();
});
$('#quickWorkoutForm').addEventListener('submit', e=>{
  e.preventDefault();
  const arr=load(K.workouts); arr.push({date:todayISO(), type:$('#qwType').value, notes:$('#qwNotes').value.trim(), tags:toTags($('#qwTags').value)});
  save(K.workouts,arr); $('#qwNotes').value=''; $('#qwTags').value=''; renderWorkouts($('#wFilter').value); toast('Workout logged'); drawCharts();
});
$('#wClearFilter').addEventListener('click', ()=>{ $('#wFilter').value=''; renderWorkouts(''); });
$('#wFilter').addEventListener('input', e=> renderWorkouts(e.target.value));

/* -------- Journal -------- */
function renderJournal(filterTag=''){
  const list=$('#journalList'); list.innerHTML='';
  const items=load(K.journal);
  const tag=filterTag.trim().toLowerCase();
  const filtered= tag ? items.filter(i=>(i.tags||[]).some(t=>t.toLowerCase()===tag)) : items;
  if(filtered.length===0){ list.innerHTML='<div class="item small">No entries yet.</div>'; return; }
  filtered.sort((a,b)=> b.date.localeCompare(a.date));
  for(const it of filtered){
    const div=document.createElement('div'); div.className='item';
    const tags=(it.tags||[]).map(t=>`<span class="badge">#${t}</span>`).join(' ');
    div.innerHTML = `<h4>${it.date} ${tags}</h4>
      <div>${(it.text||'').replace(/\\n/g,'<br>')}</div>
      <div class="row-end"><button data-act="del">Delete</button></div>`;
    div.querySelector('[data-act="del"]').addEventListener('click', ()=>{
      save(K.journal, load(K.journal).filter(x=>!(x.date===it.date && x.text===it.text)));
      renderJournal(tag); toast('Entry deleted');
    });
    list.appendChild(div);
  }
}
$('#journalForm').addEventListener('submit', e=>{
  e.preventDefault();
  const date=$('#jDate').value||todayISO(), text=$('#jText').value.trim(); if(!text){ toast('Write something first'); return; }
  const tags=toTags($('#jTags').value); const arr=load(K.journal); arr.push({date,text,tags}); save(K.journal,arr);
  $('#jText').value=''; $('#jTags').value=''; renderJournal($('#jFilter').value); toast('Entry saved');
});
$('#quickJournalForm').addEventListener('submit', e=>{
  e.preventDefault();
  const text=$('#qjText').value.trim(); if(!text){ toast('Write something first'); return; }
  const tags=toTags($('#qjTags').value); const arr=load(K.journal); arr.push({date:todayISO(), text, tags}); save(K.journal,arr);
  $('#qjText').value=''; $('#qjTags').value=''; renderJournal($('#jFilter').value); toast('Journal saved');
});
$('#jClearFilter').addEventListener('click', ()=>{ $('#jFilter').value=''; renderJournal(''); });
$('#jFilter').addEventListener('input', e=> renderJournal(e.target.value));

/* -------- Charts -------- */
function weeksAgo(dstr){ const d=new Date(dstr+'T00:00:00'); const now=new Date(); return Math.floor((now-d)/(1000*60*60*24*7)); }
function drawWorkoutsPerWeek(ctx, data){
  const W=ctx.canvas.width, H=ctx.canvas.height; ctx.clearRect(0,0,W,H);
  ctx.strokeStyle='#94a3b8'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(40,10); ctx.lineTo(40,H-30); ctx.lineTo(W-10,H-30); ctx.stroke();
  const weeks=12, counts=Array.from({length:weeks},()=>0);
  for(const it of data){ const w=weeksAgo(it.date); if(w>=0&&w<weeks) counts[weeks-1-w]++; }
  const maxY=Math.max(3,...counts), xStep=(W-60)/(weeks-1), yScale=(H-50)/maxY;
  ctx.fillStyle='#94a3b8'; ctx.font='12px system-ui';
  for(let y=0;y<=maxY;y++){ const yy=H-30-y*yScale; ctx.globalAlpha=y===0?1:0.25; ctx.beginPath(); ctx.moveTo(40,yy); ctx.lineTo(W-10,yy); ctx.stroke(); ctx.globalAlpha=1; ctx.fillText(String(y),10,yy+4); }
  ctx.strokeStyle='#22c55e'; ctx.lineWidth=2; ctx.beginPath();
  counts.forEach((c,i)=>{ const x=40+i*xStep, y=H-30-c*yScale; if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); }); ctx.stroke();
  ctx.fillStyle='#22c55e'; counts.forEach((c,i)=>{ const x=40+i*xStep, y=H-30-c*yScale; ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill(); });
  ctx.fillStyle='#94a3b8'; for(let i=0;i<weeks;i+=2){ const x=40+i*xStep; ctx.fillText(`-${weeks-1-i}w`, x-10, H-10); }
}
function drawTypesLast30(ctx, data){
  const W=ctx.canvas.width, H=ctx.canvas.height; ctx.clearRect(0,0,W,H);
  const now=new Date(); const recent=data.filter(it=> (now - new Date(it.date+'T00:00:00')) <= 30*24*60*60*1000);
  const map={}; for(const it of recent){ map[it.type]=(map[it.type]||0)+1; }
  const entries=Object.entries(map).sort((a,b)=>b[1]-a[1]); if(entries.length===0){ ctx.fillStyle='#94a3b8'; ctx.font='14px system-ui'; ctx.fillText('No workouts in last 30 days', 40, H/2); return; }
  const barH=24,gap=12,maxVal=Math.max(...entries.map(e=>e[1])), usableW=W-160; let y=20;
  entries.forEach(([type,val])=>{ const barW=(val/maxVal)*usableW; ctx.fillStyle='#22c55e33'; ctx.fillRect(140,y-8,barW,barH); ctx.fillStyle='#22c55e'; ctx.fillRect(140,y-8,Math.max(2,barW-2),barH-4); ctx.fillStyle='#94a3b8'; ctx.fillText(type,20,y+6); ctx.fillText(String(val), 140+barW+8, y+6); y+=barH+gap; });
}
function drawCharts(){ const workouts=load(K.workouts); drawWorkoutsPerWeek($('#wkChart').getContext('2d'), workouts); drawTypesLast30($('#typeChart').getContext('2d'), workouts); }

/* -------- Export / Import (copy/paste) -------- */
$('#exportBtn').addEventListener('click', async ()=>{
  const data={ workouts:load(K.workouts), journal:load(K.journal), templates:load(K.templates), exportedAt:new Date().toISOString() };
  const txt=JSON.stringify(data,null,2);
  try{ await navigator.clipboard.writeText(txt); toast('Copied backup to clipboard'); }
  catch{ const box=document.createElement('textarea'); box.value=txt; document.body.appendChild(box); box.select(); document.execCommand('copy'); box.remove(); toast('Copied backup'); }
});
$('#importBtn').addEventListener('click', ()=>{
  try{
    const data=JSON.parse($('#importBox').value);
    if(data.workouts) save(K.workouts, data.workouts);
    if(data.journal)  save(K.journal,  data.journal);
    if(data.templates)save(K.templates,data.templates);
    renderWorkouts($('#wFilter').value); renderJournal($('#jFilter').value); renderCustomTemplates(); drawCharts(); toast('Import complete');
  }catch{ toast('Invalid JSON'); }
});

/* -------- Boot -------- */
(function init(){ renderWorkouts(); renderJournal(); renderCustomTemplates(); drawCharts(); })();
</script>
</body>
</html>
